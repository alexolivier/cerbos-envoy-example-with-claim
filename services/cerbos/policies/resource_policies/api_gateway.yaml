# yaml-language-server: $schema=https://api.cerbos.dev/latest/cerbos/policy/v1/Policy.schema.json
apiVersion: api.cerbos.dev/v1
resourcePolicy:
  version: default
  resource: api_gateway
  importDerivedRoles:
    - account_roles
  rules:
    - name: allow-documents
      actions: [route]
      effect: EFFECT_ALLOW
      roles:
        - admin
        - user
      condition:
        match:
          expr: request.resource.attr.path == "/api/documents"
      output:
        when:
          ruleActivated: |-
            {"x-authz-accountId": request.auxData.jwt.accountId, "x-authz-id": request.principal.id, "x-authz-roles": request.principal.roles, "x-authz-foo": "bar"}

    - name: allow-profiles
      actions: [route]
      effect: EFFECT_ALLOW
      roles:
        - admin
        - user
      condition:
        match:
          expr: request.resource.attr.path == "/api/profiles"
      output:
        when:
          ruleActivated: |-
            {"x-authz-accountId": request.auxData.jwt.accountId, "x-authz-id": request.principal.id, "x-authz-roles": request.principal.roles, "x-authz-baz": "qux"}
